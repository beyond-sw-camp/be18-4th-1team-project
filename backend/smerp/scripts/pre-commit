#!/bin/sh

# === Root & Gradle Path 설정 ===
PROJECT_ROOT=$(git rev-parse --show-toplevel)

# OS 감지 (Windows, macOS, Linux 대응)
if [ "$(uname -s | tr '[:upper:]' '[:lower:]')" = "darwin" ] || [ "$(uname -s | tr '[:upper:]' '[:lower:]')" = "linux" ]; then
    GRADLEW_PATH="$PROJECT_ROOT/backend/smerp/gradlew"        # macOS/Linux용
else
    GRADLEW_PATH="$PROJECT_ROOT/backend/smerp/gradlew.bat"    # Windows용
fi

# === Spotless 실행 ===
echo "Running spotlessApply. Formatting code..."
cd "$PROJECT_ROOT/backend/smerp" && "$GRADLEW_PATH" spotlessApply

if [ $? -ne 0 ]; then
  echo "Spotless apply failed!"
  exit 1
fi

# === 변경 파일 다시 add ===
stagedFiles=$(git diff --staged --name-only)
for file in $stagedFiles; do
  if test -f "$file"; then
    git add "$file"
  fi
done
